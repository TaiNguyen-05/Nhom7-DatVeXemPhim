{% extends 'base.html' %}

{% block title %}Thanh toán chuyển khoản - MovieBooking{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="/static/css/all_templates.css">
{% endblock %}

{% block content %}
<section class="bank-transfer-section">
  <div class="container">
    <div class="row justify-content-center">
      <div class="col-lg-8">
        <div class="bank-transfer-card">
          <div class="bank-transfer-header">
            <h2><i class="fas fa-university me-2"></i>Thanh toán chuyển khoản</h2>
            <p class="mb-0">Vui lòng chuyển khoản theo thông tin bên dưới</p>
          </div>
          
          <div class="p-4">
            <!-- Amount Highlight -->
            <div class="amount-highlight">
              <i class="fas fa-money-bill-wave me-2"></i>
              {{ booking.total_amount|floatformat:0 }} VNĐ
            </div>
            
            <!-- Transfer Steps -->
            <div class="transfer-steps">
              <h5 class="mb-3"><i class="fas fa-list-ol me-2"></i>Hướng dẫn chuyển khoản</h5>
              <div class="step-item">
                <div class="step-number">1</div>
                <div>Mở ứng dụng ngân hàng của bạn</div>
              </div>
              <div class="step-item">
                <div class="step-number">2</div>
                <div>Chọn chức năng chuyển khoản</div>
              </div>
              <div class="step-item">
                <div class="step-number">3</div>
                <div>Nhập thông tin tài khoản bên dưới</div>
              </div>
              <div class="step-item">
                <div class="step-number">4</div>
                <div>Nhập nội dung chuyển khoản</div>
              </div>
              <div class="step-item">
                <div class="step-number">5</div>
                <div>Xác nhận và hoàn tất giao dịch</div>
              </div>
            </div>
            
            <!-- Bank Information -->
            <div class="bank-info-card">
              <h5 class="text-center mb-4"><i class="fas fa-university me-2"></i>Thông tin tài khoản</h5>
              
              <div class="row">
                <div class="col-md-6">
                  <div class="account-info">
                    <div class="info-item">
                      <span><strong>Ngân hàng:</strong></span>
                      <span>{{ payment.bank_account.get_bank_name_display }}</span>
                    </div>
                    <div class="info-item">
                      <span><strong>Số tài khoản:</strong></span>
                      <div class="d-flex align-items-center">
                        <span class="me-2">{{ payment.bank_account.account_number }}</span>
                        <button class="copy-btn" onclick="copyToClipboard('{{ payment.bank_account.account_number }}', this)">
                          <i class="fas fa-copy"></i>
                        </button>
                      </div>
                    </div>
                    <div class="info-item">
                      <span><strong>Chủ tài khoản:</strong></span>
                      <span>{{ payment.bank_account.account_holder }}</span>
                    </div>
                    {% if payment.bank_account.branch %}
                    <div class="info-item">
                      <span><strong>Chi nhánh:</strong></span>
                      <span>{{ payment.bank_account.branch }}</span>
                    </div>
                    {% endif %}
                  </div>
                </div>
                
                <div class="col-md-6">
                  <div class="qr-code-section">
                    <div class="qr-placeholder">
                      <i class="fas fa-qrcode"></i>
                    </div>
                    <p class="text-muted">QR Code sẽ được cập nhật sớm nhất</p>
                  </div>
                </div>
              </div>
            </div>
            
            <!-- Transfer Content -->
            <div class="account-info">
              <h6><i class="fas fa-comment me-2"></i>Nội dung chuyển khoản</h6>
              <div class="info-item">
                <span><strong>Nội dung:</strong></span>
                <div class="d-flex align-items-center">
                  <span class="me-2">{{ payment.transfer_content|default:'Thanh toan ve phim' }}</span>
                  <button class="copy-btn" onclick="copyToClipboard('{{ payment.transfer_content|default:'Thanh toan ve phim' }}', this)">
                    <i class="fas fa-copy"></i>
                  </button>
                </div>
              </div>
            </div>
            
            <!-- Form -->
            <form method="post">
              {% csrf_token %}
              <div class="row">
                <div class="col-md-6">
                  <div class="mb-3">
                    <label for="{{ form.sender_account.id_for_label }}" class="form-label">
                      <i class="fas fa-user me-2"></i>{{ form.sender_account.label }}
                    </label>
                    {{ form.sender_account }}
                    {% if form.sender_account.errors %}
                    <div class="text-danger">{{ form.sender_account.errors }}</div>
                    {% endif %}
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="mb-3">
                    <label for="{{ form.sender_name.id_for_label }}" class="form-label">
                      <i class="fas fa-user-tag me-2"></i>{{ form.sender_name.label }}
                    </label>
                    {{ form.sender_name }}
                    {% if form.sender_name.errors %}
                    <div class="text-danger">{{ form.sender_name.errors }}</div>
                    {% endif %}
                  </div>
                </div>
              </div>
              
              <div class="mb-3">
                <label for="{{ form.transfer_content.id_for_label }}" class="form-label">
                  <i class="fas fa-comment me-2"></i>{{ form.transfer_content.label }}
                </label>
                {{ form.transfer_content }}
                {% if form.transfer_content.errors %}
                <div class="text-danger">{{ form.transfer_content.errors }}</div>
                {% endif %}
              </div>
              
              <div class="text-center">
                <button type="submit" class="btn btn-success btn-lg px-5">
                  <i class="fas fa-check me-2"></i>Xác nhận đã chuyển khoản
                </button>
                <a href="{% url 'payment_method' booking.id %}" class="btn btn-outline-secondary btn-lg px-5 ms-2">
                  <i class="fas fa-arrow-left me-2"></i>Quay lại
                </a>
              </div>
            </form>
            
            <!-- Important Notes -->
            <div class="alert alert-warning mt-4">
              <h6><i class="fas fa-exclamation-triangle me-2"></i>Lưu ý quan trọng:</h6>
              <ul class="mb-0">
                <li>Vui lòng chuyển khoản đúng số tiền và nội dung</li>
                <li>Giao dịch sẽ được xử lý trong vòng 5-10 phút</li>
                <li>Nếu có vấn đề, vui lòng liên hệ hotline: 1900-xxxx</li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<script>
function copyToClipboard(text, button) {
  navigator.clipboard.writeText(text).then(function() {
    button.innerHTML = '<i class="fas fa-check"></i>';
    button.classList.add('copied');
    setTimeout(function() {
      button.innerHTML = '<i class="fas fa-copy"></i>';
      button.classList.remove('copied');
    }, 2000);
  });
}
</script>
{% endblock %} 